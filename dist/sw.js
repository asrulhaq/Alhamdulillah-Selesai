const CACHE_NAME="story-app-v1";self.addEventListener("install",(t=>{console.log("ðŸ”§ Service Worker: Installing..."),self.skipWaiting()})),self.addEventListener("activate",(t=>{console.log("ðŸš€ Service Worker: Activating..."),t.waitUntil(self.clients.claim())})),self.addEventListener("push",(t=>{console.log("ðŸ“¬ Push event received:",t);let i={title:"Story berhasil dibuat",body:"Anda telah membuat story baru",icon:"/icons/icon-192x192.png",badge:"/icons/badge-72x72.png",tag:"story-notification",requireInteraction:!1,data:{url:"/"}};if(t.data)try{const o=t.data.json();console.log("ðŸ“¨ Push data (JSON):",o),i={...i,title:o.title||i.title,body:o.options?.body||o.body||i.body,icon:o.options?.icon||o.icon||i.icon,badge:o.options?.badge||o.badge||i.badge,tag:o.options?.tag||o.tag||i.tag,data:o.data||i.data}}catch(o){try{const o=t.data.text();console.log("ðŸ“¨ Push data (text):",o),o&&o.trim()&&(i.body=o)}catch(t){console.error("âŒ Error parsing push data as text:",t)}}const o=self.registration.showNotification(i.title,{body:i.body,icon:i.icon,badge:i.badge,tag:i.tag,requireInteraction:i.requireInteraction,data:i.data,actions:[{action:"view",title:"ðŸ‘€ Lihat"},{action:"close",title:"âŒ Tutup"}]}).catch((t=>(console.error("âŒ Error showing notification:",t),self.registration.showNotification("Story App",{body:"Anda memiliki notifikasi baru",tag:"fallback-notification"}))));t.waitUntil(o)})),self.addEventListener("notificationclick",(t=>{if(console.log("ðŸ”” Notification clicked:",t),t.notification.close(),"view"===t.action||!t.action){const i=t.notification.data?.url||"/";t.waitUntil(self.clients.matchAll({type:"window"}).then((t=>{for(let i=0;i<t.length;i++){const o=t[i];if(o.url.includes(self.location.origin)&&"focus"in o)return o.focus()}if(self.clients.openWindow)return self.clients.openWindow(i)})))}}));